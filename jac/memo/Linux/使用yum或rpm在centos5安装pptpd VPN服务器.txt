关于pptpd
pptpd程序是linux下通用的pptp VPN 服务器开发源码程序，官方网站：http://www.poptop.org/ 本文详细介绍如何安装、配置pptpd

安装前期环境
开启路由转发
方法一：

echo "echo 1 > /proc/sys/net/ipv4/ip_forward" >> /etc/rc.local
echo 1 > /proc/sys/net/ipv4/ip_forward

方法二：

vi /etc/sysctl.conf
net.ipv4.ip_forward = 1
/sbin/sysctl -p

安装iptables包，NAT转发需要
yum -y install iptables libpcap
yum -y remove ppp

上面卸载ppp包的原因是使用当前包与pptpd包不兼容

安装
方法一：使用yum安装（适合i386)

rpm -Uvh http://poptop.sourceforge.net/yum/stable/fc7/pptp-release-current.noarch.rpm
yum -y --enablerepo=poptop-stable --disablerepo=base install pptpd ppp

方法二：使用rpm包安装：(适合x86_64 CentOS 5.4)

yum -y install ppp
cd /usr/src
wget http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-1.rhel5.1.i386.rpm
rpm -ivh pptpd-1.3.4-1.rhel5.1.i386.rpm

配置
配置pptpd.conf文件
mv /etc/pptpd.conf /etc/pptpd.conf.bak
vi /etc/pptpd.conf
option /etc/ppp/options.pptpd
debug
logwtmp
localip 10.10.10.1
remoteip 10.10.10.2-254

配置options.pptpd文件
mv /etc/ppp/options.pptpd /etc/ppp/options.pptpd.bak
vi /etc/ppp/options.pptpd
name lihxvpn15099
refuse-pap
refuse-chap
refuse-mschap
require-mschap-v2
require-mppe-128
proxyarp
nobsdcomp
novj
novjccomp
nologfd
ms-dns 4.2.2.1
ms-dns 4.2.2.2

添加pptpd拨号帐号
这里以添加帐号为:vpntest 密码为：vpntestpassword
方法一：使用vpnuser脚本添加

vpnuser add vpntest vpntestpassword

方法二：直接编辑/etc/ppp/chap-secrets

vi /etc/ppp/chap-secrets
echo -e 'vpntest * vpntestpassword *' >> /etc/ppp/chap-secrets

配置iptables转发
启动iptables及配置nat转发

/etc/init.d/iptables start
iptables -t nat -F
iptables -t nat -A POSTROUTING -o eth0 -s 10.10.10.0/24 -j MASQUERADE
iptables -t nat -L -n
iptables -L -n
service iptables save

如果你使用固定ip，可以使用下面语句

iptables -t nat -A POSTROUTING -o eth0 -s 10.10.10.0/24 -j SNAT --to ipaddress
#此处的ipaddress为你的固定ip地址

替换：

iptables -t nat -A POSTROUTING -o eth0 -s 10.10.10.0/24 -j MASQUERADE

配置pptp开机启动及运行
chkconfig --level 345 pptpd on
/etc/init.d/pptpd start

经过上述几个步骤，pptpd vpn服务器就配置完了，关于windows 拨号程序客户端配置，请查看此文章：
http://vpn.15099.net/2009/09/winxp-vpn-configure.html

额外说明
检查是否支持mppe

strings `which pppd`|grep -i mppe|wc --lines 

如有输出行数，代表支持 
如使用方法一,使用yum安装，升级系统需使用下面命令

yum -x ppp -y update

排除ppp升级 
