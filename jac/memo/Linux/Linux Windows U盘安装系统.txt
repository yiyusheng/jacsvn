写在前面：刚接触一个网站建设的项目。大大小小各种设备一共四十几台设备需要安装系统。原本第一考虑是使用部署服务器做个网启分发。没想到这四十几台设备当中大概20台安装Windows，剩下的安装Red Hat 6.0与 Red Hat 5.4。这其中Linux又分32位与64位，再加上机器全未上架，网线最快也要两天左右调好。想用硬盘对刻，但设备都是两硬盘以上做了raid。考虑再三，决定使用U盘安装系统，前前后后折腾将近一周。收获颇丰，于是就有了这篇心得。

 

一、系统安装信息获取

开始阶段的信息获取相当重要，以系统部署来说，以上架有网络，全部统一系统的话就没必要用U盘折腾了。

U盘安装系统的优势在于：

1、安装系统速度快：U盘读取速度远胜光盘，网络分发对于大批量机器没有一个好的网络速度同样不敢恭维。

2、介质便于携带：U盘容量够大完全可以把几个完全不同版本系统放入U盘之中，同时修改系统引导项就可以了。

3、可以省下一个光驱，同样可以省下好几张光盘，或者完全就是没有光盘的时候，U盘更是不二选择。

以上，如何选择全凭个人爱好。

其他需要提前获取的一些信息：

1、需要安装的系统：Linux或者Windows等，版本以及64位32位之类的最好也一并问到。

2、系统安装要求：计算机名，网络地址，磁盘分区等等。此类信息还是很有必要。

 

二、安装准备

看需求准备几块U盘这是肯定的，标签，纸笔什么也是很有必要，这些就不多说了。

值得说的是：

1、U盘引导制作：以我自己为例，我自己比较使用 杏雨梨云U盘PE，安装简单，自带GRUB4DOS引导

杏雨梨云USB维护系统中秋版-A版（全隐藏UD版）

至于其他PE自己参考一下，引导只要能用就行。

2、系统镜像：Windows系统安装的话只要ISO镜像就可以了，直接放U盘某目录下。Linux的话还需解压ISO镜像里isolinux、images两个目录，并且Linux ISO镜像文件、isolinux、images 这三个目录必须放入同一目录。

3、自动应答文件制作：自动应答文件是实现快速安装必要步骤之一。如果要想全自动安装的话，Windows2003 需要配置sif文件，Linux则需要配置kickstart文件，Red Hat可以在安装完成的机器上的/home目录找到生成好的kickstart配置文件，相当省事。visita/08 之类暂时无解。配置文件限于篇幅不多说，还是一句话自行参考。文末会附上一份sif跟kickstart配置文件参考

4、新机器磁盘控制器驱动：这点相当恼人，需要看情况修改镜像或者grub4dos模拟软驱，Linux只要修改配置文件应该就好了

准备这样也就差不多了

 

三、系统安装（都是以上面的U盘PE为例）

1、Red Hat Linux系列：

手动安装：启动电脑进入选择界面时，选择 “硬盘启动计算机”进入GRUB4DOS，进入GRUB4DOS后其他引导菜单无视掉，直接按C进入命令模式。依次输入

---------------------

root (hd0,0)

kernel /(Linux ISO目录)/isolinux/vmlinuz [可选参数黑屏时可以试试 xdriver=vesa]

initrd /(Linux ISO目录)/isolinux/initrd.img

boot

---------------------

成功引导后 在选择镜像来源时选择 Hard Driver，接着选择U盘后输入路径 /(Linux ISO目录) 回车就好，剩下步骤完全与光盘一样

可以先安装一台以后直接提前kickstart配置文件

 

2、其他liveCD版Linux

命令稍微不同

----------------------

root (hd0,0)

kernel /iso目录/isolinux/vmlinuz boot=casper iso-scan/filename=/iso目录/LinuxLiveCD.iso

initrd /iso目录/isolinux/initrd.img

boot

-----------------------

进入图形界面后进入终端输入

sudo umount -l /isodevice 

然后运行图形安装即可

 

3、Windows NT 5.X XP/03系统安装

最简单的办法是进入PE后安装。

先用分区工具分区，注意设置活动分区。接着挂载镜像，该PE可以直接运行ISO文件挂载镜像。

杏雨梨云PE里面自带5个Windows系统安装器，选择一个NT5.X安装器，选择挂载的光驱，在选择sif文件等待文件复制完成重启即可。。。

03用这种方法速度快到令人发指了，简直跟ghost不相上下。

 

4、Windows NT6.X vista/win7/2008 系统安装

同样适用PE安装，分区完成需要注意的是，该PE自带的分区工具分区完都是NT5.X MBR引导。下载个bootice，或者BCD引导修复工具能在PE下用的都行修复下。建议使用bootice，非常方便。

挂载ISO镜像跟03一样，选择一个NT6镜像安装器 选择挂载分区和安装盘后一样NEXT

 

四、全自动安装

最理想的情况就是硬盘无系统，硬盘启动比U盘启动优先，插入U盘后重启，由于硬盘无系统所以自动引导U盘，进入自动安装。待二次重启时，硬盘引导已经完成，自动引导硬盘进行安装，而不会再次引导U盘重新格式化系统。达到批量快速部署的目的。此法在U盘数量足够时，安装速度可以完全压过网络分发。（U盘临时借几个应该是没什么压力的，这个项目当时20几台Linux需要换系统，只花了小半天。其中花时间还是U盘拷贝镜像速度太慢。。）

目前以我自己来说的话可以实现的只有Red Hat Linux，NT5.X 或者 NT6.X也并不难实现，只是目前还没来得及折腾而已。

NT5.X大概思路，可以使用GRUB4DOS自动引导DOS系统进入DOS执行自动分区脚本后使用CMD脚本自动安装，网上应该也有相关教程。

NT6.X大概思路，NT6.X安装方式跟NT5.X完全不一样，网上大概搜索了一下 是用imagex命令恢复到C盘什么的。自动分区配合强大的diskpart。应该不是什么难事。

Linux实现方式：

1、配置GRUB4DOS引导，使用上面推荐的PE其实也行，但单纯对于Linux来说完全没有必要。

直接下载个新版的grub4dos，解压其中的grldr menu.lst文件放入U盘根目录。再使用上面推荐的bootice修改U盘MBR引导为GRUB4DOS 0.45就可以了。

编辑menu.lst，甚至连menu.lst都可以不用，直接用bootice打开grldr文件，里头有个内置的menu.lst

------------------------------------


timeout 5

default 0

 

title Install Red Hat Linux

root (hd0,0)

kernel /iso目录/isolinux/vmlinuz xdriver=vesa ks=hd:sdb1/ks.cfg

initrd /iso目录/isolinux/initrd.img

boot

-------------------------------------


ks参数就是指定kickstart应答文件的位置 hd指本地磁盘，sdb1是Linux进入安装后磁盘。不能确定的话，先用上面手工安装的方法进入安装界面。在磁盘分区的地方就可以确认哪个是U盘,对不上的话需要进行修改，连kickstart配置文件需要一起改动。

2、kickstart配置文件

手动安装完成的配置文件里面磁盘分区默认是被注释掉的。要想全自动安装的话必须取消注释

kickstart文件示例

-----------------------------------------------------------------------


# Kickstart file automatically generated by anaconda.

#version=RHEL6

install

#跳过输入序列号

key --skip

#镜像文件来源，需要根据实际自行修改

harddrive --partition=/dev/sdb1 --dir=//image/64/

lang en_US.UTF-8

keyboard us

#root用户密码

rootpw  --iscrypted xxxxxx

firewall --disabled

authconfig --enableshadow --passalgo=sha512 --enablefingerprint

selinux --disabled

timezone --utc Asia/Shanghai

#MBR安装位置，也很重要

bootloader --location=mbr --driveorder=sda,sdb --append="nomodeset crashkernel=auto rhgb quiet"

#磁盘分区信息，需要再次谨慎

clearpart --all --drives=sda

part /home --fstype=ext4  --grow --size=100

part / --fstype=ext4  --grow --size=1024 --maxsize=51200

part swap  --grow --size=1024 --maxsize=10048

part /boot --fstype=ext4 --size=500

part None --fstype=vfat --onpart=sdb1 --noformat

#安装包信息

repo --name="Red Hat Enterprise Linux"  --baseurl=file:///mnt/source --cost=100

 

%packages

@additional-devel

@albanian-support

@amazigh-support

@arabic-support

@armenian-support

@assamese-support

@azerbaijani-support

@backup-client

@backup-server

@base


……




-------------------------------------------------------------------------

完毕，配置完成最好拿台机器实验一下




附：参考win2003 应答sif文件

----------------------------------------------------------


[data]

msdosinitiated="1"

floppyless="1"

AutoPartition="0"

UseSignatures="yes"

InstallDir="\WINDOWS"

EulaComplete="1"

winntupgrade="no"

win9xupgrade="no"

Win32Ver="ece0205"

uniqueid="X:\WXPE\FPH"

#E盘是ISO挂载的虚拟光驱

OriSrc="E:\"

OriTyp="5"

FileSystem=ConvertNTFS

[regionalsettings]

Language=00000804

LanguageGroup=10

[userdata]

productid="HXCRB-TQW9R-42JK8-TQ7X2-PJRDY"

productkey="HXCRB-TQW9R-42JK8-TQ7X2-PJRDY"

-----------------------------------------------------------------------